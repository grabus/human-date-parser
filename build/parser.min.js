function ParserDate(a){return this instanceof ParserDate?(this._changed={},void(this.date=new Date(a))):new ParserDate(a)}function leapyear(a){return a%4===0&&a%100!==0||a%400===0}function ParserRegulars(a){var b=ParserRegularsLocales[a]||ParserRegularsLocales.en;for(var c in b)this[c]=b[c]}function HumanDateParser(a,b,c){return this instanceof HumanDateParser?(this.r=new ParserRegulars(c),"string"==typeof b&&(b=new HumanDateParser(b,null,c).parse()),this.d=b||new Date,this.date=new ParserDate(this.d),this.original=a,this.str=a.toLowerCase(),this.stash=[],void(this.tokens=[])):new HumanDateParser(a,b,c)}if("undefined"==typeof module)var module={};module.exports=ParserDate;var _second=1e3,_minute=60*_second,_hour=60*_minute,_day=24*_hour,_week=7*_day,_year=56*_week,_daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31];ParserDate.prototype={clone:function(){return new Date(this.date)},changed:function(a){return void 0===this._changed[a]?!1:this._changed[a]},second:function(a){var b=+a*_second;return this.update(b),this._changed.seconds=!0,this},minute:function(a){var b=+a*_minute;return this.update(b),this._changed.minutes=!0,this},hour:function(a){var b=+a*_hour;return this.update(b),this._changed.hours=!0,this},day:function(a){var b=+a*_day;return this.update(b),this._changed.days=!0,this},week:function(a){var b=+a*_week;return this.update(b),this._changed.weeks=!0,this},month:function(a){var b=this.date,c=b.getDate();b.setDate(1);var d=+a+b.getMonth();b.setMonth(d);var e=this.daysInMonth(d);return b.setDate(Math.min(e,c)),this},daysInMonth:function(a){var b=(_daysInMonth[a],leapyear(this.date.getFullYear()));return 1==a&&b?29:28},year:function(a){var b=this.date.getFullYear();return b+=+a,this.date.setFullYear(b),this._changed.years=!0,this},time:function(a,b,c){return a===!1?a=this.date.getHours():(a=+a||0,this._changed.hours=a),b===!1?b=this.date.getMinutes():(b=+b||0,this._changed.minutes=b),c===!1?c=this.date.getSeconds():(c=+c||0,this._changed.seconds=c),this.date.setHours(a,b,c),this},updateDay:function(a,b){b=+(b||1);var c=(a-this.date.getDay()+7)%7;return b>0&&--b,c+=7*b,this.update(c*_day),this},update:function(a){return this.date=new Date(this.date.getTime()+a),this}};var days=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];days.forEach(function(a,b){ParserDate.prototype[days[b]]=function(a){this._changed.days=!0,this.updateDay(b,a)}}),"undefined"!=typeof module&&(module.exports=ParserRegulars),ParserRegulars.prototype={dayMod:/\b(morning|noon|afternoon|night|evening|midnight)\b/,pastTest:function(a){return this.past.some(function(b){return b.r.test(a)})},weekDaysTest:function(a){return this.weekDays.some(function(b){return new RegExp(b.r).test(a)})},findMonths:function(a){for(var b=0,c=this.months.length;c>b;b++){var d,e=this.months[b];if(d=e.r.exec(a))return[d[0],d[2],e.name]}},findAgo:function(a){for(var b=0,c=this.agos.length;c>b;b++){var d,e=this.agos[b];if(d=e.r.exec(a))return[d[0],d[1],e.name]}}};var ParserRegularsLocales={ru:{at:"в",space:/^([ \t]+)/,number:/^(\d+)/,string:/^\w+/,other:/^./,second:/^сек(унд(а|ы|у)?)/,minute:/^мин(ут(а|у)?)?/,hour:/^ч(ас|асов)?/,day:/^д(ень|ня|ней)?/,week:/^нед(ел(я|и|ь))?/,month:/^месяц(ев|а)?(?=\s|$)/,year:/^(г(од(а|у|ами)?)?|лет)/,yesterday:/^вчера/,tomorrow:/^завтра/,noon:/^полдень(?=\s|$)/,midnight:/^полночь(?=\s|$)/,night:/^ночь(ю)?(?=\s|$)/,evening:/^вечер(ом)?(?=\s|$)/,afternoon:/^днем(?=\s|$)/,morning:/^утр(о|а|ом)(?=\s|$)/,tonight:/^сегодня\sвечером(?=\s|$)/,next:/^след(ующ(ая|ий|ие|ее))?/,last:/^прошл(ый|ое|ая|ой|ым)/,ago:/^назад(?=\s|$)/,meridiem:/^(\d{1,2})([:.](\d{1,2}))?([:.](\d{1,2}))?\s*([ap]m)/,hourMinute:/^(\d{1,2})([:.](\d{1,2}))([:.](\d{1,2}))?/,atHour:/^в\s?(\d{1,2})$/,past:[{name:"last",r:/(?:^|\s)(прошл(ый|ое|ая|ой|ым))(?=\s|$)/},{name:"yesterday",r:/(?:^|\s)(вчера)(?=\s|$)/},{name:"ago",r:/(?:^|\s)(назад)(?=\s|$)/}],weekDays:[{name:"sunday",r:"(?:^|\\s)(вс|воскресень(е|я|ю|и))(?=\\s|$)"},{name:"monday",r:"(?:^|\\s)(пн|понедельник(а|у|и)?)(?=\\s|$)"},{name:"tuesday",r:"(?:^|\\s)(вт|вторник(а|у|и)?)(?=\\s|$)"},{name:"wednesday",r:"(?:^|\\s)(ср|сред(а|у|ы)?)(?=\\s|$)"},{name:"thursday",r:"(?:^|\\s)(чт|четверг(у|а|и)?)(?=\\s|$)"},{name:"friday",r:"(?:^|\\s)(пт|пятниц(а|у|е|ы)?)(?=\\s|$)"},{name:"saturday",r:"(?:^|\\s)(сб|суббот(а|у|е|ы)?)(?=\\s|$)"}],months:[{name:"january",r:/^(\d{1,2})\s(январ(ь|я|е|ю))/},{name:"february",r:/^(\d{1,2})\s(феврал(ь|я|е|ю))/},{name:"march",r:/^(\d{1,2})\s(март(а|е)?)/},{name:"april",r:/^(\d{1,2})\s(апрел(ь|я|е|ю))/},{name:"may",r:/^(\d{1,2})\s(ма(й|я|е))/},{name:"june",r:/^(\d{1,2})\s(июн(ь|я|е|ю))/},{name:"july",r:/^(\d{1,2})\s(июл(ь|я|е|ю))/},{name:"august",r:/^(\d{1,2})\s(август(а|е)?)/},{name:"september",r:/^(\d{1,2})\s(сентябр(ь|я|е|ю))/},{name:"october",r:/^(\d{1,2})\s(октябр(ь|я|е|ю))/},{name:"november",r:/^(\d{1,2})\s(ноябр(ь|я|е|ю))/},{name:"december",r:/^(\d{1,2})\s(декабр(ь|я|е|ю))/}],findMonths:function(a){for(var b=0,c=this.months.length;c>b;b++){var d,e=this.months[b];if(d=e.r.exec(a))return[d[0],d[1],e.name]}},agos:[{name:"second",r:/^(\d*)\s?(?:^|\s)(секунд(а|ы|у)?)(?=\s|$)\s?назад$/},{name:"minute",r:/^(\d*)\s?(?:^|\s)(минут(а|ы|у)?)(?=\s|$)\s?назад$/},{name:"hour",r:/^(\d*)\s?(?:^|\s)(час(ов|а)?)(?=\s|$)\s?назад$/},{name:"day",r:/^(\d*)\s?(?:^|\s)(день|дня|дней)(?=\s|$)\s?назад$/},{name:"week",r:/^(\d*)\s?(?:^|\s)(недел(я|и|ь|ю))(?=\s|$)\s?назад$/},{name:"month",r:/^(\d*)\s?(?:^|\s)(месяц(а|ев)?)(?=\s|$)\s?назад$/},{name:"year",r:/^(\d*)\s?(?:^|\s)(год(а)?|лет)(?=\s|$)\s?назад$/}]},en:{at:"at",space:/^([ \t]+)/,number:/^(\d+)/,string:/^\w+/,other:/^./,second:/^s(ec|econd)?s?/,minute:/^m(in|inute)?s?/,hour:/^h(r|our)s?/,day:/^d(ay)?s?/,week:/^w(k|eek)s?/,month:/^mon(th)?(es|s)?\b/,year:/^y(r|ear)s?/,yesterday:/^(yes(terday)?)/,tomorrow:/^tom(orrow)?/,noon:/^noon\b/,midnight:/^midnight\b/,night:/^night\b/,evening:/^evening\b/,afternoon:/^afternoon\b/,morning:/^morning\b/,tonight:/^tonight\b/,next:/^next/,last:/^last/,ago:/^ago\b/,meridiem:/^(\d{1,2})([:.](\d{1,2}))?([:.](\d{1,2}))?\s*([ap]m)/,hourMinute:/^(\d{1,2})([:.](\d{1,2}))([:.](\d{1,2}))?/,atHour:/^at\s?(\d{1,2})$/,past:[{name:"last",r:/\b(last)\b/},{name:"yesterday",r:/\b(yesterday)\b/},{name:"ago",r:/\b(ago)\b/}],weekDays:[{name:"sunday",r:"\\b(sun(day)?)s?\\b"},{name:"monday",r:"\\b(mon(day)?)s?\\b"},{name:"tuesday",r:"\\b(tues(day)?)s?\\b"},{name:"wednesday",r:"\\b(wed(nesday)?)s?\\b"},{name:"thursday",r:"\\b(thur(sday|s)?)s?\\b"},{name:"friday",r:"\\b(fri(day)?)s?\\b"},{name:"saturday",r:"\\b(sat(urday)?)s?\\b"}],months:[{name:"january",r:/^((\d{1,2})(st|nd|rd|th))\sof\s(january)/},{name:"february",r:/^((\d{1,2})(st|nd|rd|th))\sof\s(february)/},{name:"march",r:/^((\d{1,2})(st|nd|rd|th))\sof\s(march)/},{name:"april",r:/^((\d{1,2})(st|nd|rd|th))\sof\s(april)/},{name:"may",r:/^((\d{1,2})(st|nd|rd|th))\sof\s(may)/},{name:"june",r:/^((\d{1,2})(st|nd|rd|th))\sof\s(june)/},{name:"july",r:/^((\d{1,2})(st|nd|rd|th))\sof\s(july)/},{name:"august",r:/^((\d{1,2})(st|nd|rd|th))\sof\s(august)/},{name:"september",r:/^((\d{1,2})(st|nd|rd|th))\sof\s(september)/},{name:"october",r:/^((\d{1,2})(st|nd|rd|th))\sof\s(october)/},{name:"november",r:/^((\d{1,2})(st|nd|rd|th))\sof\s(november)/},{name:"december",r:/^((\d{1,2})(st|nd|rd|th))\sof\s(december)/}],agos:[{name:"second",r:/^(\d*)\s?\b(second)[s]?\b\s?ago$/},{name:"minute",r:/^(\d*)\s?\b(minute)[s]?\b\s?ago$/},{name:"hour",r:/^(\d*)\s?\b(hour)[s]?\b\s?ago$/},{name:"day",r:/^(\d*)\s?\b(day)[s]?\b\s?ago$/},{name:"week",r:/^(\d*)\s?\b(week)[s]?\b\s?ago$/},{name:"month",r:/^(\d*)\s?\b(month)[s]?\b\s?ago$/},{name:"year",r:/^(\d*)\s?\b(year)[s]?\b\s?ago$/}]}};if("undefined"!=typeof module&&(module.exports=HumanDateParser),"undefined"!=typeof require)var ParserDate=require("./parser-date"),ParserRegulars=require("./parser-regulars");HumanDateParser.prototype={parse:function(){for(;"eos"!==this.advance(););if(this.nextTime(this.d),this.date.date==this.d)throw new Error("Invalid date");var a=!this.tokens.every(function(a){return"other"==a||"eos"==a});return a?this.date.date:!1},months:["january","february","march","april","may","june","july","august","september","october","november","december"],advance:function(){var a=this.eos()||this.space()||this._next()||this.last()||this.dayByName()||this.monthByName()||this.timeAgo()||this.ago()||this.yesterday()||this.tomorrow()||this.noon()||this.midnight()||this.night()||this.evening()||this.afternoon()||this.morning()||this.tonight()||this.meridiem()||this.hourminute()||this.athour()||this.week()||this.month()||this.year()||this.second()||this.minute()||this.hour()||this.day()||this.number()||this.string()||this.other();return this.tokens.push(a),a},lookahead:function(a){var b=a-this.stash.length;if(0==b)return this.lookahead(++a);for(;b-->0;)this.stash.push(this.advance());return this.stash[--a]},peek:function(){return this.lookahead(1)},next:function(){return this.stashed()||this.advance()},stashed:function(){return this.stash.shift()},skip:function(a){this.str=this.str.substr(Array.isArray(a)?a[0].length:a)},eos:function(){return this.str.length?void 0:"eos"},space:function(){var a;return(a=this.r.space.exec(this.str))?(this.skip(a),this.advance()):void 0},second:function(){var a;return(a=this.r.second.exec(this.str))?(this.skip(a),"second"):void 0},minute:function(){var a;return(a=this.r.minute.exec(this.str))?(this.skip(a),"minute"):void 0},hour:function(){var a;return(a=this.r.hour.exec(this.str))?(this.skip(a),"hour"):void 0},day:function(){var a;return(a=this.r.day.exec(this.str))?(this.skip(a),"day"):void 0},dayByName:function(){for(var a=0;a<this.r.weekDays.length;a++){var b,c=this.r.weekDays[a],d=new RegExp("^"+c.r);if(b=d.exec(this.str)){var e=c.name;return this.skip(b),this.date[e](1),e}}},monthByName:function(){var a;if(a=this.r.findMonths(this.str)){var b=a[1],c=a[2];return this.date.date.setMonth(this.months.indexOf(c)),b&&this.date.date.setDate(parseInt(b)-1),this.skip(a),a[0]}},timeAgo:function(){var a;if(a=this.r.findAgo(this.str)){var b=a[1],c=a[2];return this.date[c](-b),this.skip(a),"timeAgo"}},week:function(){var a;return(a=this.r.week.exec(this.str))?(this.skip(a),"week"):void 0},month:function(){var a;return(a=this.r.month.exec(this.str))?(this.skip(a),"month"):void 0},year:function(){var a;return(a=this.r.year.exec(this.str))?(this.skip(a),"year"):void 0},meridiem:function(){var a;return(a=this.r.meridiem.exec(this.str))?(this.skip(a),this.time(a[1],a[3],a[5],a[6]),"meridiem"):void 0},hourminute:function(){var a;return(a=this.r.hourMinute.exec(this.str))?(this.skip(a),this.time(a[1],a[3],a[5]),"hourminute"):void 0},athour:function(){var a;return(a=this.r.atHour.exec(this.str))?(this.skip(a),this.time(a[1],0,0,this._meridiem),this._meridiem=null,"athour"):void 0},time:function(a,b,c,d){{var e=this.date;e.clone()}d&&(a="pm"==d&&12>a?+a+12:a,a="am"==d&&12==a?0:a),b=!b&&e.changed("minutes")?!1:b,c=!c&&e.changed("seconds")?!1:c,e.time(a,b,c)},nextTime:function(a){var b=this.date,c=this.original;return a<=b.date||this.r.pastTest(c)?this:(this.r.weekDaysTest(c)?b.day(7):(a-b.date)/1e3>60&&b.day(1),this)},yesterday:function(){var a;return(a=this.r.yesterday.exec(this.str))?(this.skip(a),this.date.day(-1),"yesterday"):void 0},tomorrow:function(){var a;return(a=this.r.tomorrow.exec(this.str))?(this.skip(a),this.date.day(1),"tomorrow"):void 0},noon:function(){var a;if(a=this.r.noon.exec(this.str)){this.skip(a);{this.date.clone()}return this.date.date.setHours(12,0,0),"noon"}},midnight:function(){var a;if(a=this.r.midnight.exec(this.str)){this.skip(a);{this.date.clone()}return this.date.date.setHours(0,0,0),"midnight"}},night:function(){var a;if(a=this.r.night.exec(this.str)){this.skip(a),this._meridiem="pm";{this.date.clone()}return this.date.date.setHours(19,0,0),"night"}},evening:function(){var a;if(a=this.r.evening.exec(this.str)){this.skip(a),this._meridiem="pm";{this.date.clone()}return this.date.date.setHours(17,0,0),"evening"}},afternoon:function(){var a;if(a=this.r.afternoon.exec(this.str)){this.skip(a),this._meridiem="pm";{this.date.clone()}return this.date.changed("hours")?"afternoon":(this.date.date.setHours(14,0,0),"afternoon")}},morning:function(){var a;if(a=this.r.morning.exec(this.str)){this.skip(a),this._meridiem="am";{this.date.clone()}return this.date.changed("hours")||this.date.date.setHours(8,0,0),"morning"}},tonight:function(){var a;return(a=this.r.tonight.exec(this.str))?(this.skip(a),this._meridiem="pm","tonight"):void 0},_next:function(){var a;if(a=this.r.next.exec(this.str)){this.skip(a);var b=new Date(this.date.date),c=this.peek();return this.date[c]?(this.next(),this.date=ParserDate(b),this.date[c](1)):this.r.dayMod.test(c)&&this.date.day(1),"next"}},last:function(){var a;if(a=this.r.last.exec(this.str)){this.skip(a);var b=new Date(this.date.date),c=this.peek();return this.date[c]?(this.next(),this.date=ParserDate(b),this.date[c](-1)):this.r.dayMod.test(c)&&this.date.day(-1),"last"}},ago:function(){var a;return(a=this.r.ago.exec(this.str))?(this.skip(a),"ago"):void 0},number:function(){var a;if(a=this.r.number.exec(this.str)){var b=a[1];this.skip(a);var c=this.peek();return this.date[c]?("ago"==this.peek()&&(b=-b),this.date[c](b)):this._meridiem?(this.time(b,0,0,this._meridiem),this._meridiem=null):this.original.indexOf(this.r.at)>-1&&(this.time(b,0,0,this._meridiem),this._meridiem=null),"number"}},string:function(){var a;return(a=this.r.string.exec(this.str))?(this.skip(a),"string"):void 0},other:function(){var a;return(a=this.r.other.exec(this.str))?(this.skip(a),"other"):void 0}};